function FixPaths() {
    // Webpack likes to make relative paths between its
    // generated HTML and its bundles(etc), but the paths
    // it generates aren't how Wagtail serves files so we
    // need to rewrite the paths
}

FixPaths.prototype.apply = function fixPathsApply(compiler) {
    const AUTOGENERATED_COMMENT =
        '\n{% comment %}\n\n  DEV WARNING\n\n  THIS FILE IS AUTO-GENERATED FROM "*_src" DIRECTORY. DO NOT EDIT!\n\n{% endcomment %}\n';
    // eslint-disable-next-line arrow-parens
    compiler.plugin('compilation', compilation => {
        // eslint-disable-next-line arrow-parens
        compilation.plugin(
            'html-webpack-plugin-after-html-processing',
            // eslint-disable-next-line arrow-parens
            data => {
                // fix relative paths so that browsers can resolve them
                /* eslint-disable no-param-reassign */
                data.html =
                    AUTOGENERATED_COMMENT +
                    data.html.replace(
                        /\.\.\/static\/(.*?)(["'])/gi,
                        "{% static '$1' %}$2",
                    );
            },
        );
    });
};

module.exports = FixPaths;
